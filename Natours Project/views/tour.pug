extends base

block append scripts
  script.
    const data = !{JSON.stringify(tourData.locations)}

block append head
  link(rel='stylesheet', href='https://unpkg.com/leaflet/dist/leaflet.css')
  script(src='https://unpkg.com/leaflet/dist/leaflet.js')
  script(src='/js/mapbox.js')
  script(src='https://js.stripe.com/v3/')
  script(type='module' src='/js/booking.js')


  //- script(src='/js/stripe.js')

block content
  main.main
    section.section-header
      .header__hero
        .header__hero-overlay &nbsp;
        img.header__hero-img(src=`/img/tours/${tourData.imageCover}`, alt='Tour 5')

      .heading-box
        h1.heading-primary
          span #{tourData.name}
        .heading-box__group
          .heading-box__detail
            svg.heading-box__icon
              use(xlink:href='/img/icons.svg#icon-clock')
            span.heading-box__text #{tourData.duration} days
          .heading-box__detail
            svg.heading-box__icon
              use(xlink:href='/img/icons.svg#icon-map-pin')
            span.heading-box__text #{tourData.startLocation.description}

    section.section-description
      .overview-box
        div
          .overview-box__group
            h2.heading-secondary.ma-bt-lg Quick facts
            .overview-box__detail
              svg.overview-box__icon
                use(xlink:href='/img/icons.svg#icon-calendar')
              span.overview-box__label Next date
              span.overview-box__text #{new Date(tourData.startDates[1]).toLocaleString('default', { month: 'long', year: 'numeric' })}
            .overview-box__detail
              svg.overview-box__icon
                use(xlink:href='/img/icons.svg#icon-trending-up')
              span.overview-box__label Difficulty
              span.overview-box__text #{tourData.difficulty}
            .overview-box__detail
              svg.overview-box__icon
                use(xlink:href='/img/icons.svg#icon-user')
              span.overview-box__label Participants
              span.overview-box__text #{tourData.maxGroupSize} people
            .overview-box__detail
              svg.overview-box__icon
                use(xlink:href='/img/icons.svg#icon-star')
              span.overview-box__label Rating
              span.overview-box__text #{tourData.ratingsAverage} / 5

          .overview-box__group
            h2.heading-secondary.ma-bt-lg Your tour guides
            each guide in tourData.guides
              .overview-box__detail
                img.overview-box__img(src=`/img/users/${guide.photo}`, alt='Lead guide')
                span.overview-box__label #{guide.role}
                span.overview-box__text #{guide.name}

      .description-box
        h2.heading-secondary.ma-bt-lg About #{tourData.name}
        each line in tourData.description.split('+')
          p.description__text #{line.trim()}
          br

    section.section-pictures
      each pic,i in tourData.images
        .picture-box
          img(class=`picture-box__img picture-box__img--${i+1}`,src=`/img/tours/${pic}`, alt=`${tourData.name} ${i+1}`)
  
    section.section-map
      #map

    section.section-reviews
      .reviews
        each reviewData in tourData.Reviews
          .reviews__card
            .reviews__avatar
              img.reviews__avatar-img(src=`/img/users/${reviewData.user.photo}`, alt=`${reviewData.user.name}`)
              h6.reviews__user #{reviewData.user.name}
            p.reviews__text #{reviewData.review}
            br
            .reviews_rating
               - for (let i = 0; i < reviewData.rating; i++)
                  svg.reviews__star.reviews__star--active
                    use(xlink:href='/img/icons.svg#icon-star')

    section.section-cta
      .cta
        .cta__img.cta__img--logo
          img(src='/img/logo-white.png', alt='Natours logo')
        each pic,i in tourData.images
          if i < 2
            img.cta__img.cta__img--1(src=`/img/tours/${pic}`, alt='')
        .cta__content
          h2.heading-secondary What are you waiting for?
          p.cta__text 10 days. 1 adventure. Infinite memories. Make it yours today!
          if user
            if isBooked
              button#cancelBooking.btn.btn--green.span-all-rows(data-tour-id=`${tourData._id}`) Cancel Tour Now!
            else
              button#bookNow.btn.btn--green.span-all-rows(data-tour-id=`${tourData._id}`) Book tour now!
          else
            button.btn.btn--green.span-all-rows Login to Book this tour !

